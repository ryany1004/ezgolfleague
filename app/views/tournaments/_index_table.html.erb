<div class="col-md-12">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title"><%= title %></h3>
    </div>
    <table class="table table-striped">
    	<thead>
    		<tr>
          <th>Name</th>
    			<th>League</th>
          <th>Course</th>
          <th>Date</th>
          <th>Signup</th>
          <th>Players</th>
          <th>Playable?</th>
          <th>Manage</th>
          <th><% if show_create == true -%><%= link_to 'Create Tournament', new_league_tournament_path(current_user.selected_league), :class => 'btn btn-primary' %><% else -%>&nbsp;<% end -%></th>
    		</tr>
    	</thead>
    	<tbody>
    	<% tournaments.each do |tournament| %>
        <% if current_user.is_super_user || tournament.league.membership_for_user(current_user)&.is_admin %>
      		<tr>
            <td><%= link_to_unless !is_editable?(tournament), tournament.name, edit_league_tournament_path(tournament.league, tournament) %></td>
            <td><%= tournament.league.name %><br/><%= tournament.season_name %></td>
            <td>
              <% tournament.tournament_days.each do |day| -%>
                <%= day.course.name %><br/>
              <% end -%>
            </td>
            <td>
              <% tournament.tournament_days.each do |day| -%>
                <%= day.tournament_at.to_s(:short) %><br/>
              <% end -%>
            </td>
            <td><%= tournament.signup_opens_at.to_s(:short) %></td>
            <td><%= tournament.players.count %> / <%= tournament.max_players %></td>
            <td>
              <% tournament.tournament_days.each do |day| -%>
                <%= human_boolean(day.can_be_played?) %><br/>
              <% end -%>
            </td>
            <td>
            <div class="btn-group">
              <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                Details <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <% if tournament.tournament_days.count > 0 %>
                <li><%= link_to "Signups", league_tournament_day_players_path(tournament.league, tournament, tournament.tournament_days.first) %></li>
                <% end %>
                <li><%= link_to "Scorecards", scorecards_path(tournament_id: tournament) %></li>
                <li class="divider"></li>
                <li><%= link_to "Game Type", edit_league_tournament_game_types_path(tournament.league, tournament) %></li>
                <li><%= link_to "Tee Times", league_tournament_tournament_groups_path(tournament.league, tournament) %></li>
                <li><%= link_to "Flights", league_tournament_flights_path(tournament.league, tournament) %></li>
                <li><%= link_to "Payouts", league_tournament_payouts_path(tournament.league, tournament) %></li>
                <li><%= link_to "Contests", league_tournament_contests_path(tournament.league, tournament) %></li>
                <li><%= link_to 'Notifications', league_tournament_tournament_notifications_path(tournament.league, tournament) %></li>
                <% if tournament.tournament_days.count > 1 %>
                <li class="divider"></li>
                <li><%= link_to "Auto-Schedule For Secondary Days", league_tournament_auto_schedule_path(tournament.league, tournament), :data => { :confirm => 'Are you sure you want to schedule secondary days? This will remove any existing scores for those days.' }, method: :patch %></li>
                <% end %>
                <li class="divider"></li>
                <li><%= link_to 'Calculate Results', league_tournament_finalize_path(tournament.league, tournament) %></li>
                <li class="divider"></li>
                <% if current_user.is_super_user || tournament.is_past? == false -%>
                <li><%= link_to "Recalculate Course Handicaps", league_tournament_update_course_handicaps_path(tournament.league, tournament), method: :patch %></li>
                <% end -%>
                <li><%= link_to "Recalculate Tournament Scoring", league_tournament_rescore_players_path(tournament.league, tournament), method: :patch, :data => { :confirm => 'This will re-calculate all tournament scores. Can be useful if you have changed underlying data.' } %></li>
                <li><%= link_to "Remove Cached Data", league_tournament_touch_tournament_path(tournament.league, tournament), method: :patch, :data => { :confirm => 'Are you sure you want to remove the cached data? Regenerating the data can take several minutes the next time it is accessed.' } %></li>
              </ul>
            </div>
            </td>
            <td>
              <% if is_editable?(tournament) -%><%= link_to "Edit", edit_league_tournament_path(tournament.league, tournament) %> | <%= link_to 'Delete', league_tournament_path(tournament.league, tournament), :data => { :confirm => 'Are you sure you want to delete this tournament? That will remove all player score data and results.' }, :method => :delete %><% else -%><em>Currently underway.</em><% end -%>

              <% if tournament.can_be_finalized? && tournament.is_finalized == false %>
                <p>
                  <%= link_to 'Calculate Results', league_tournament_finalize_path(tournament.league, tournament), :class => "btn btn-danger btn-sm", :role => "button", :style => "margin-top:5px;" %>
                </p>
              <% end %>
            </td>
      		</tr>
        <% end %>
    	<% end %>
    	</tbody>
      <tfoot>
    		<tr>
    			<th>&nbsp;</th>
          <th>&nbsp;</th>
    			<th>&nbsp;</th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th><% if show_create == true -%><%= link_to 'Create Tournament', new_league_tournament_path(current_user.selected_league), :class => 'btn btn-primary' %><% else -%>&nbsp;<% end -%></th>
    		</tr>
      </tfoot>
    </table>
  </div>
</div>
