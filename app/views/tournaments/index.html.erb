<script>
  mixpanel.identify();
  
  amplitude.getInstance().setUserId('<%= current_user.id %>');

  ezglTrackAnalyticsEvent("Viewed the list of tournaments");

  _dcq.push(["identify", {
    email: "<%= current_user.email %>",
    first_name: "<%= current_user.first_name %>",
    last_name: "<%= current_user.last_name %>",
    tags: <%= current_user.drip_tags.to_json.html_safe %>,
    success: function(response) {
    // Call a method with the response object
    // Success callback is optional
    }
  }]);
</script>

<div class="row">
  <% if current_user.selected_league&.alert_missing_next_season? || show_subscription_needed? %>
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Important Information</h3>
        </div>
        <div class="panel-body">
          <% if current_user.selected_league&.alert_missing_next_season? %>
            <p>Please be sure to create your next season so that your golfers can pay dues and you can create your tournaments.</p>
            <p><%= link_to "Manage Your Seasons", league_league_seasons_path(current_user.selected_league), class: 'btn btn-primary' %></p>
            <br/>
          <% end %>

          <% if show_subscription_needed? %>
          	<% if free_trial_remaining? %>
          		<p>You currently have <%= pluralize(current_user.selected_league.free_tournaments_remaining, 'free tournament') %> remaining for <%= current_user.selected_league.name %>.</p>
          	<% else %>
          		<p>Your free trial is expired - you won't be able to create any new tournaments until you activate a subscription.</p>

          		<p><%= link_to "View Your Subscription", current_league_subscription_credits_path(current_user.selected_league), class: 'btn btn-primary' %></p>
          	<% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <% unless @unconfigured_tournaments.blank? -%>
    <%= render partial: 'index_table', locals: {tournaments: @unconfigured_tournaments, title: "Setup In Process", show_create: false} %>
  <% end -%>

  <% unless @upcoming_tournaments.blank? -%>
    <%= render partial: 'index_table', locals: {tournaments: @upcoming_tournaments, title: "Upcoming Tournaments", show_create: @can_create_tournaments} %>
  <% end -%>

  <% unless @past_tournaments.blank? -%>
    <%= render partial: 'index_table', locals: {tournaments: @past_tournaments, title: "Past Tournaments", show_create: @can_create_tournaments} %>
  <% end -%>

  <% if @can_create_tournaments && @upcoming_tournaments.blank? -%>
    <% if @past_tournaments.blank? -%>
      <h4>You don't have any tournaments yet.</h4>
      <%= link_to 'Create Tournament', new_league_tournament_path(current_user.selected_league), class: 'btn btn-primary' %>
    <% end -%>
  <% end -%>

  <%= link_to_prev_page @past_tournaments, '← Previous Page', :class => 'btn btn-default' %>
  <%= link_to_next_page @past_tournaments, 'Next Page →', :class => 'btn btn-default' %>
</div>