<ol class="breadcrumb">
  <li><%= link_to "Tournaments", league_tournaments_path(current_user.selected_league) %></li>
  <li><%= link_to @tournament.name, edit_league_tournament_path(current_user.selected_league, @tournament) %></li>
  <li class="active">Finalize Tournament</li>
</ol>

<%= render partial: '/shared/tournaments/manage', locals: {tournament: @tournament, stage: @stage_name} %>

<% if @tournament.players.count == 0 -%>
  <p><strong>This tournament does not yet have any players and cannot be finalized.</strong></p>
<% else -%>
  <!-- Progress Bar -->
  <div class="modal fade" id="progressModal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Finalize Tournament</h4>
        </div>
        <div class="modal-body">
          <p>Finalizing a tournament will analyze scores and determine payouts by flight as well as for contests.</p>
          <p>This process takes a few minutes (or more for large or multi-day tournaments). When complete, the page will reload automatically and display the results.</p>
          <p><strong>Please don't refresh your browser manually. You will receive an email when finalization is complete.</strong></p>
          <%= link_to "Start Finalization", league_tournament_run_finalization_path(current_user.selected_league, @tournament), :id => 'finalize-button', :class => 'btn btn-primary', :role => 'button', remote: true %>
          <br/><br/>
          <div class='progress-status text-primary'>
            0
          </div>
          <div class='progress progress-striped active'>
            <div class='progress-bar'>
              <div class='text-primary'>
                0%
              </div>
            </div>
          </div>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  <script>
  $(document).ready(function() {
      $('#progressModal').modal('show');
  });
  </script>
  <!-- End PB -->
<% end -%>
