<ol class="breadcrumb">
  <li><%= link_to "My Dashboard", play_dashboard_index_path %></li>
  <li class="active"><%= @tournament.name %></li>
</ol>

<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Tournament Info</h3>
      </div>
      <div class="panel-body">
        <span class="label label-default">When</span>
        <h4><%= @tournament.tournament_at.to_s(:date_and_time) %></h4>
        <span class="label label-default">Where</span>
        <h4><%= @tournament.course.name %></h4>
        <% unless @tournament.course.street_address_1.blank? -%>
          <p>
            <%= @tournament.course.street_address_1 %><br/>
            <%= @tournament.course.city %>, <%= @tournament.course.us_state %> <%= @tournament.course.postal_code %><br/>
            <%= link_to "View on Map", "https://www.google.com/maps/place/#{@tournament.course.street_address_1}+#{@tournament.course.city}+#{@tournament.course.us_state}+#{@tournament.course.postal_code}" %>
          </p>
        <% end -%>
      </div>
      <ul class="list-group">
        <li class="list-group-item"><strong>Sign Ups:</strong> <%= @tournament.signup_opens_at.to_s(:date_and_time) %> - <%= @tournament.signup_closes_at.to_s(:date_and_time) %></li>
      </ul>
      <% if @tournament.includes_player?(current_user) -%>
      <ul class="list-group">
        <li class="list-group-item"><span class="badge"><%= @tournament.player_score(current_user) %></span><%= link_to "Your Scorecard", play_scorecard_path(@tournament.primary_scorecard_for_user(current_user)) %></li>
      </ul>
      <% end -%>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="panel panel-default panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Tournament Payouts</h3>
      </div>
      <% if @tournament.is_finalized -%>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Flight</th>
            <th>Name</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <% @tournament.flights.each_with_index do |f, x| %>
            <% f.payouts.each do |p| %>
            <tr>
              <td><strong><%= f.flight_number %></strong></td>
              <td><%= p.user.complete_name unless p.user.blank? %></td>
              <td><%= number_to_currency(p.amount) %></td>
            </tr>
            <% end %>
            <% if x < @tournament.flights_with_rankings.count - 1 -%>
            <tr>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <% else -%>
      <div class="panel-body">
      Payout information will be available once the tournament has been finalized by the league administrator.
      </div>
      <% end -%>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="panel panel-default panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Tournament Contests</h3>
      </div>
      <% if @tournament.contests.order("name").count > 0 -%>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Contest</th>
            <th>Winner(s)</th>
            <th>Amount</th>
            <th>Points</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <% @tournament.contests.each do |contest| %>
          <tr>
            <td><%= contest.name %></td>
            <td><%= format_winners(contest.winners) %></td>
            <td><%= format_payout(contest.winners) %></td>
            <td><%= format_points(contest.winners) %></td>
            <td><%= format_results(contest.winners) %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <% else -%>
      <div class="panel-body">
      This tournament does not have any contests setup.
      </div>
      <% end -%>
    </div>
  </div>
</div>

<div class="row">
  <% if @tournament.golfer_teams.count == 0 -%>
    <%= render partial: 'tournament_players_individual', locals: {tournament: @tournament} %>
  <% else -%>
    <%= render partial: 'tournament_players_teams', locals: {tournament: @tournament} %>
  <% end -%>
  
  <div class="col-md-6">
    <div class="panel panel-default panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Tournament Rankings</h3>
      </div>
      <% if @tournament.has_scores? -%>
      <table class="table table-striped">
      	<thead>
      		<tr>
            <th>Flight</th>
      			<th>Rank</th>
            <th>Player</th>
            <th>Net</th>
            <th>Gross</th>
            <th>Points</th>
      		</tr>
      	</thead>
        <tbody>
          <% cache(cache_key_for_tournament(@tournament)) do %>
            <% @tournament.flights_with_rankings.each_with_index do |flight, x| %>
              <% flight[:players].each_with_index do |player, i| -%>
              <tr>
                <td><strong><%= flight[:flight_number] %></strong></td>
                <td><strong><%= i + 1 %></strong></td>
                <td><%= player[:name] %></td>
                <td><%= player[:net_score] %></td>
                <td><%= player[:gross_score] %> | <%= link_to "Scorecard", player[:scorecard_url] %></td>
                <td><%= player[:points].to_i %></td>
              </tr>
              <% end -%>
              <% if x < @tournament.flights_with_rankings.count - 1 -%>
              <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
              </tr>
              <% end -%>
            <% end -%>
          <% end -%>
        </tbody>
      </table>
      <% else -%>
      <div class="panel-body">
        Rankings will be available once the tournament is underway.
      </div>
      <% end -%>
    </div>
  </div>
</div>