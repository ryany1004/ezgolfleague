<h4>Tee-Time: <%= primary_scorecard.golf_outing.team.tournament_group.tee_time_at.to_s(:date_and_time) %></h4>

<table class="table table-striped table-bordered print-friendly">
	<thead>
		<tr>
      <th width="3%">Flight</th>
      <th width="5%">Hole<br/>Yards</th>
      <% primary_scorecard.scores.each_slice(primary_scorecard.tournament_day.course_holes.count / 2).to_a.each_with_index do |split, j| %>
        <% split.each do |score| -%>
        <th width="<%= 70 / primary_scorecard.scores.count %>%"><%= score.course_hole.hole_number %><br/><%= score.course_hole.yards_for_flight(primary_scorecard.tournament_day.flight_for_player(primary_scorecard.golf_outing.user)) %></th>
        <% end -%>
        <th width="6%">
          <% if j == 0 -%>
            Out
          <% else -%>
            Out / In
          <% end -%>
        </th>
      <% end -%>
      
      <th width="3%">HDCP</th>
      
      <% if primary_scorecard.includes_extra_scoring_column? -%>
        <th width="5%">&nbsp;</th>
      <% end -%>
      
      <th width="7%">Gross</th>
		</tr>
	</thead>
	<tbody>
    <% other_scorecards.insert(0, primary_scorecard).each do |scorecard| -%>
      <!-- Scorecard ID: <%= scorecard.id %> -->
      <tr>
        <td><%= scorecard.flight_number %></td>
        <% if scorecard.should_highlight? -%>
          <td><em><%= scorecard.name %></em></td>
        <% else -%>
          <td><%= scorecard.name %></td>
        <% end -%>
        <% scorecard.scores.each_slice(primary_scorecard.tournament_day.course_holes.count / 2).to_a.each_with_index do |split, j| %>
          <% split.each do |score| -%>
            <td>
              <%= link_to_unless !primary_scorecard.tournament_day.user_can_edit_scorecard(current_user, scorecard), "#{scorecard_score_helper(score, print_mode)}", "#", {"data-toggle" => "modal", "data-target" => "#Group#{score.course_hole.id}"} %>
              
              <% if handicap_allowance_strokes_for_hole(handicap_allowance_for_scorecard(scorecard), score.course_hole) > 0 -%>
                </br><span class="label label-success">-<%= handicap_allowance_strokes_for_hole(handicap_allowance_for_scorecard(scorecard), score.course_hole) %></span>
              <% end -%>
              
              <% unless score.associated_text.blank? -%>
                </br><em><%= score.associated_text %></em>
              <% end -%>
              
              <% unless primary_scorecard.tournament_day.game_type.scorecard_score_cell_partial.blank? -%>
                </br><%= render partial: primary_scorecard.tournament_day.game_type.scorecard_score_cell_partial, locals: {score: score, scorecards: other_scorecards} %>
              <% end -%>
            </td>
          <% end -%>
          <td>
            <% if scorecard.should_subtotal? -%>
              <strong>
                <% if j == 0 -%>
                  <%= scorecard.front_nine_score %> <%= front_nine_handicap_for_scorecard(scorecard) %>
                <% else -%>
                  <%= scorecard.front_nine_score %> <%= front_nine_handicap_for_scorecard(scorecard) %><br/><%= scorecard.back_nine_score %> <%= back_nine_handicap_for_scorecard(scorecard) %>
                <% end -%>
              </strong>
            <% else -%>
              &nbsp;
            <% end -%>
          </td>
        <% end -%>

        <td><%= scorecard.course_handicap %></td>
        
        <% if primary_scorecard.includes_extra_scoring_column? -%>
          <td><strong><%= scorecard.extra_scoring_column_data %></strong></td>
        <% end -%>

        <td>
          <% if scorecard.should_total? -%>
            <strong><%= scorecard.scores.map {|score| score.strokes }.sum %></strong>
            <% if scorecard.net_score > 0-%>
            <span class="label label-success">
              <%= scorecard.net_score %>
            </span>
            <% end -%>
          <% else -%>
            &nbsp;
          <% end -%>
        </td> 
      </tr>
    <% end -%>
	</tbody>
  <tfoot>
		<tr>
      <th>&nbsp;</th>
			<th>Par</th>
      <% primary_scorecard.scores.each_slice(primary_scorecard.tournament_day.course_holes.count / 2).to_a.each_with_index do |split, j| %>
        <% split.each do |score| -%>
          <th><%= score.course_hole.par %></th>
        <% end -%>
        <th>&nbsp;</th>
      <% end -%>
      
      <th>&nbsp;</th>
      
      <% if primary_scorecard.includes_extra_scoring_column? -%>
        <th>&nbsp;</th>
      <% end -%>
      
      <th><%= primary_scorecard.tournament_day.course_holes.map {|hole| hole.par }.sum %></th>
		</tr>
		<tr>
      <th>HDCP</th>
			<th>Men</th>
      <% primary_scorecard.scores.each_slice(primary_scorecard.tournament_day.course_holes.count / 2).to_a.each_with_index do |split, j| %>
        <% split.each do |score| -%>      
          <th><%= score.course_hole.mens_handicap %></th>
        <% end -%>
        <th>&nbsp;</th>
      <% end -%>
      
      <th>&nbsp;</th>
      
      <% if primary_scorecard.includes_extra_scoring_column? -%>
        <th>&nbsp;</th>
      <% end -%>
      <th>&nbsp;</th>
		</tr>
		<tr>
      <th>&nbsp;</th>
			<th>Women</th>
      <% primary_scorecard.scores.each_slice(primary_scorecard.tournament_day.course_holes.count / 2).to_a.each_with_index do |split, j| %>
        <% split.each do |score| -%>      
          <th><%= score.course_hole.mens_handicap %></th>
        <% end -%>
        <th>&nbsp;</th>
      <% end -%>
      
      <th>&nbsp;</th>
      
      <% if primary_scorecard.includes_extra_scoring_column? -%>
        <th>&nbsp;</th>
      <% end -%>
      
      <th>&nbsp;</th>
		</tr>
  </tfoot>
</table>

<!-- Game Type Support -->
<% unless primary_scorecard.tournament_day.game_type.scorecard_post_embed_partial.blank? -%>
  <%= render partial: primary_scorecard.tournament_day.game_type.scorecard_post_embed_partial, locals: {scorecards: other_scorecards, course_holes: primary_scorecard.tournament_day.course_holes} %>
<% end -%>

<!-- Finalize Buttons -->
<% if primary_scorecard.has_empty_scores? == false && primary_scorecard.tournament_day.user_can_edit_scorecard(current_user, primary_scorecard) == true && primary_scorecard.tournament_day.tournament.is_finalized == false -%>
  <p><%= link_to 'Finalize Scorecard', play_scorecard_finalize_scorecard_path(primary_scorecard), :class => 'btn btn-danger', :method => :patch, :data => { :confirm => 'Are you sure you want to finalize your scorecard? This indicates to the league administrator that you are ready to be ranked for this tournament.' } %></p>
<% end -%>

<!-- Modals -->
<% cache(cache_key_for_scorecard(primary_scorecard.id)) do %>
  <% primary_scorecard.tournament_day.course_holes.each do |course_hole| %>
    <%= render partial: '/shared/scorecards/standard_edit_modal', locals: {primary_scorecard: primary_scorecard, course_hole: course_hole, scores: scores_for_scorecards_for_course_hole(other_scorecards, course_hole), edit_url: play_scorecard_path(primary_scorecard, original_scorecard_id: primary_scorecard.id) } %>
  <% end -%>
<% end %>